<html>
<head>
  <title>Kanso - Documentation</title>
  <link rel="stylesheet" href="http://yandex.st/highlightjs/5.16/styles/github.min.css">
  <link rel="stylesheet" href="stylesheets/kanso.css" />
</head>
<body>
  <div id="topbar"></div>
  <div id="topbar_overlay"></div>
  <div id="container">

    <ul id="navigation">
      <li><a href="index.html">Intro</a></li>
      <li><a href="tutorial.html">Tutorial</a></li>
      <li><a class="selected" href="docs.html">Docs</a></li>
      <li><a href="https://github.com/caolan/kanso">Code &rArr;</a></li>
    </ul>

    <a id="sitename" href="index.html">
      <img src="images/kanso_ribbon.png" />
    </a>

    <!-- populated by javascript -->
    <ul id="sidenav"></ul>

    <div id="docs">
      <h1>Documentation</h1>


      <h2 id="configuration">Configuration</h2>
      <p>
        Project configuration options can be added to the <code>kanso.json</code>
        file in your project directory.
      </p>
      <ul>
        <li><strong>name</strong> (String) - the name of the design document</li>
        <li><strong>load</strong> (String) - the module to get design doc properties from</li>
        <li><strong>modules</strong> (String/Array) - files and directories to load as commonjs modules</li>
        <li><strong>templates</strong> (String) - templates directory to load templates from</li>
        <li><strong>attachments</strong> (String/Array) - files and directories to load as attachments</li>
      </ul>
      <h3>Example config</h3>
    <pre><code class="javascript">{
    "name": "myblog",
    "load": "lib/app",
    "modules": "lib",
    "templates": "templates",
    "attachments": "static"
}</code></pre>

      <h2 id="app_format">App format</h2>
      <p>
        The format of the loaded module (usually lib/app.js, depending on the "load"
        setting in kanso.json) follows the format of a CouchDB design doc. Any
        exported property of this module will be added to the design doc generated
        for your app.
      </p>
      <p>
        Kanso will occasionally extend the default design doc API by adding some
        additional properties which have a special meaning.
      </p>
      <h3 id="app_format_init">Init</h3>
      <p>
        The 'init' property is expected to be a function, and will be called on the
        initial page load, once the document is ready and the commonjs environment is
        available.
      </p>
      <p>
        This property is optional and can be safely omitted. If you want to
        progressively enhance a fallback page returned by CouchDB on the first hit,
        or initialize some application state, this is the place to do it.
      </p>
      <pre><code class="javascript">exports.init = function () {
    alert('initializing app');
};</code></pre>
      <h3 id="app_format_types">Types</h3>
      <p>
        The 'types' property is used by the admin app to find types to show in the
        applications types list. It is also assumed to be the location of any
        custom types by the skeleton app's validation function.
      </p>
      <p>
        It's a good idea to export your type definitions on this property to make
        them easy to re-use and compatible with the admin app.
      </p>
      <pre><code class="javascript">exports.types = {
    example: new Type('example', {
        fields: {
            title: fields.string(),
            message: fields.string()
        }
    })
};</code></pre>
      <h3 id="app_format_sessionChange">SessionChange</h3>
      <p>
        The 'sessionChange' property is expected to be a function and is called
        whenever a change to the user's session is detected (usually after calling
        login or logout from the session module).
      </p>
      <p>
        A sessionChange event will also occur on the initial site load,
        as soon as the user's session details are available. This happens
        after the init method has fired and before the client-side
        rendering of the list, show or update function for that page.
      </p>
      <p>
        The sessionChange event accepts two arguments: the new user context object,
        and a request object, for example:
      </p>
      <pre><code class="javascript">exports.sessionChange = function (userCtx, req) {
    // re-render the session information (logged in as... etc)
    $('#session').html(
        templates.render('session.html', req, {})
    );
};</code></pre>

      <h2 id="modules">Modules</h2>
      <p>
        Documentation for the builtin CommonJS modules distributed as part of
        Kanso. All modules in this section can be used in your own code by doing:
        <code>require('kanso/&lt;name&gt;')</code>.
      </p>

      <h3 id="cookies">Cookies</h3>
      <p>Functions related to the reading and manipulation of cookies.</p>

      <h4 id="cookies_readBrowserCookies">
        cookies.readBrowserCookies()
      </h4>
      <p>
        Read cookies currently stored in the browser, returning an object
        keyed by cookie name.
      </p>
      <div class="returns"><strong>Returns:</strong> Object</div>

      <h4 id="cookies_readBrowserCookie">
        cookies.readBrowserCookie(name)
      </h4>
      <p>
        Reads browser cookies and returned the value of the named cookie.
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>name</th>
            <td class="type">String</td>
          </tr>
        </tbody>
      </table>

      <div class="returns"><strong>Returns:</strong> String</div>

      <h4 id="cookies_cookieString">
        cookies.cookieString(req, opt)
      </h4>
      <p>
        Creates a string for storing a cookie on the browser.
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>req</th>
            <td class="type">Request Object</td>
          </tr>
          <tr>
            <th>opt</th>
            <td class="type">Object</td>
          </tr>
        </tbody>
      </table>

      <div class="returns"><strong>Returns:</strong> String</div>

      <h4 id="cookies_setBrowserCookie">
        cookies.setBrowserCookie(req, opt)
      </h4>
      <p>
        Sets a cookie on the browser, for use client-side only.
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>req</th>
            <td class="type">Request Object</td>
          </tr>
          <tr>
            <th>opt</th>
            <td class="type">Object</td>
          </tr>
        </tbody>
      </table>

      <h4 id="cookies_setResponseCookie">
        cookies.setResponseCookie(req, res, opt)
      </h4>
      <p>
        Creates a Set-Cookie header on a response object.
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>req</th>
            <td class="type">Request Object</td>
          </tr>
          <tr>
            <th>res</th>
            <td class="type">Response Object</td>
          </tr>
          <tr>
            <th>opt</th>
            <td class="type">Object</td>
          </tr>
        </tbody>
      </table>


      <h3 id="core">Core</h3>
      <p>
        The core module contains functions used by kanso to facilitate the running
        of your app. You shouldn't need to use any of the functions here directly
        unless you're messing with the internals of Kanso.
      </p>

      <h4 id="core_init">
        <a href="#core_init">core.init()</a>
      </h4>
      <p>
        Called by kanso.js once the design doc has been loaded.
        You should not need to call this directly.
      </p>

      <h4 id="core_rewriteGroups">
        <a href="#core_rewriteGroups">core.rewriteGroups(pattern, url)</a>
      </h4>
      <p>Extracts groups from a url, eg:</p>
      <pre>'/some/path' with pattern '/some/:name' -&gt; {name: 'path'}</pre>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>pattern</th>
            <td class="type">String</td>
          </tr>
          <tr>
            <th>url</th>
            <td class="type">String</td>
          </tr>
        </tbody>
      </table>

      <div class="returns"><strong>Returns:</strong> Object</div>

      <h4 id="core_rewriteSplat">core.rewriteSplat(pattern, url)</h4>
      <p>Extracts a splat value from a rewrite pattern and matching URL.</p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>pattern</th>
            <td class="type">String</td>
          </tr>
          <tr>
            <th>url</th>
            <td class="type">String</td>
          </tr>
        </tbody>
      </table>

      <div class="returns"><strong>Returns:</strong> String</div>

      <h4 id="core_matchURL">core.matchURL(method, url)</h4>
      <p>
        Attempts to match rewrite from patterns to a URL, returning the
        matching rewrite object if successful.
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>method</th>
            <td class="type">String</td>
          </tr>
          <tr>
            <th>url</th>
            <td class="type">String</td>
          </tr>
        </tbody>
      </table>

      <div class="returns"><strong>Returns:</strong> Object</div>

      <h4 id="core_replaceGroups">core.replaceGroups(val, groups, splat)</h4>
      <p>
        Replace group names and splats in a string with the value of that group
        or splat, eg:
      </p>
      <pre>"/:name" with groups {name: 'test'} -&gt; "/test"</pre>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>val</th>
            <td class="type">String</td>
          </tr>
          <tr>
            <th>groups</th>
            <td class="type">Object</td>
          </tr>
          <tr>
            <th>splat</th>
            <td class="type">String</td>
          </tr>
        </tbody>
      </table>

      <div class="returns"><strong>Returns:</strong> String</div>

      <h4 id="core_createRequest">
        core.createRequest(method, url, data, match, callback)
      </h4>
      <p>
        Creates a new request object from a url and matching rewrite object.
        Query parameters are automatically populated from rewrite pattern.
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>method</th>
            <td class="type">String</td>
          </tr>
          <tr>
            <th>url</th>
            <td class="type">String</td>
          </tr>
          <tr>
            <th>data</th>
            <td class="type">Object</td>
          </tr>
          <tr>
            <th>match</th>
            <td class="type">Object</td>
          </tr>
          <tr>
            <th>callback</th>
            <td class="type">Function</td>
          </tr>
        </tbody>
      </table>

      <div class="returns"><strong>Returns via callback:</strong> Request Object</div>

      <h4 id="core_runShowBrowser">
        core.runShowBrowser(req, name, docid, callback)
      </h4>
      <p>
        Fetches the relevant document and calls the named show function.
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>req</th>
            <td class="type">Object</td>
          </tr>
          <tr>
            <th>name</th>
            <td class="type">String</td>
          </tr>
          <tr>
            <th>docid</th>
            <td class="type">String</td>
          </tr>
          <tr>
            <th>callback</th>
            <td class="type">Function</td>
          </tr>
        </tbody>
      </table>

      <h4 id="core_runUpdateBrowser">
        core.runUpdateBrowser(req, name, docid, callback)
      </h4>
      <p>
        Fetches the relevant document and calls the named update function.
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>req</th>
            <td class="type">Object</td>
          </tr>
          <tr>
            <th>name</th>
            <td class="type">String</td>
          </tr>
          <tr>
            <th>docid</th>
            <td class="type">String</td>
          </tr>
          <tr>
            <th>callback</th>
            <td class="type">Function</td>
          </tr>
        </tbody>
      </table>

      <h4 id="core_createHead">core.createHead(data)</h4>
      <p>
        Creates a fake head object from view results for passing to a list function
        being run client-side.
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>data</th>
            <td class="type">Object</td>
          </tr>
        </tbody>
      </table>

      <div class="returns"><strong>Returns:</strong> Object</div>

      <h4 id="core_runListBrowser">
        core.runListBrowser(req, name, view, callback)
      </h4>
      <p>
        Fetches the relevant view and calls the named list function with the results.
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>req</th>
            <td class="type">Object</td>
          </tr>
          <tr>
            <th>name</th>
            <td class="type">String</td>
          </tr>
          <tr>
            <th>view</th>
            <td class="type">String</td>
          </tr>
          <tr>
            <th>callback</th>
            <td class="type">Function</td>
          </tr>
        </tbody>
      </table>

      <h4 id="core_handle">
        core.handle(method, url, data)
      </h4>
      <p>
        Creates a request object for the url and runs appropriate show, list or
        update functions.
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>method</th>
            <td class="type">String</td>
          </tr>
          <tr>
            <th>url</th>
            <td class="type">String</td>
          </tr>
          <tr>
            <th>data</th>
            <td class="type">Object</td>
          </tr>
        </tbody>
      </table>

      <h4 id="core_setURL">
        core.setURL(method, url, data, hash)
      </h4>
      <p>
        Add a history entry for the given url, prefixed with the baseURL for the app.
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>method</th>
            <td class="type">String</td>
          </tr>
          <tr>
            <th>url</th>
            <td class="type">String</td>
          </tr>
          <tr>
            <th>data</th>
            <td class="type">Object</td>
            <td class="description">(Optional)</td>
          </tr>
          <tr>
            <th>hash</th>
            <td class="type">String</td>
            <td class="description">(Optional)</td>
          </tr>
        </tbody>
      </table>

      <h4 id="core_getURL">
        core.getURL()
      </h4>
      <p>
        Gets the current app-level URL (without baseURL prefix).
      </p>
      <div class="returns"><strong>Returns:</strong> String</div>

      <h4 id="core_sameOrigin">
        core.sameOrigin(a, b)
      </h4>
      <p>
        Tests is two urls are of the same origin. Accepts parsed url objects
        or strings as arguments.
      </p>
      <div class="returns"><strong>Returns:</strong> Boolean</div>

      <h4 id="core_appPath">
        core.appPath(p)
      </h4>
      <p>
        Converts a full url to an app-level url (without baseURL prefix).
        example: {baseURL}/some/path -&gt; /some/path
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>p</th>
            <td class="type">String</td>
          </tr>
        </tbody>
      </table>
      <div class="returns"><strong>Returns:</strong> String</div>

      <h4 id="core_isAppURL">
        core.isAppURL(url)
      </h4>
      <p>
        Used to decide whether to handle a link or not. Should detect app vs.
        external urls.
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>url</th>
            <td class="type">String</td>
          </tr>
        </tbody>
      </table>

      <div class="returns"><strong>Returns:</strong> Boolean</div>



      <h3 id="db">DB</h3>
      <p>Contains functions for querying and storing data in CouchDB.</p>

      <h4 id="db_request">
        db.request(options, callback)
      </h4>
      <p>
        Make a request, with some default settings and proper callback
        handling. Used behind-the-scenes by most other DB module functions.
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>options</th>
            <td class="type">Object</td>
          </tr>
          <tr>
            <th>callback</th>
            <td class="type">Function</td>
          </tr>
        </tbody>
      </table>

      <h4 id="db_getDoc">
        db.getDoc(id, q, callback)
      </h4>
      <p>
        Fetches a document from the database the app is running on. Results are
        passed to the callback, with the first argument of the callback reserved
        for any exceptions that occurred (node.js style).
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>id</th>
            <td class="type">String</td>
          </tr>
          <tr>
            <th>q</th>
            <td class="type">Object</td>
            <td class="description">(optional)</td>
          </tr>
          <tr>
            <th>callback</th>
            <td class="type">Function</td>
          </tr>
        </tbody>
      </table>

      <h4 id="db_saveDoc">
        db.saveDoc(doc, callback)
      </h4>
      <p>
        Saves a document to the database the app is running on. Results are
        passed to the callback, with the first argument of the callback reserved
        for any exceptions that occurred (node.js style).
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>doc</th>
            <td class="type">Object</td>
          </tr>
          <tr>
            <th>callback</th>
            <td class="type">Function</td>
          </tr>
        </tbody>
      </table>

      <h4 id="db_removeDoc">
        db.removeDoc(doc, callback)
      </h4>
      <p>
        Deletes a document from the database the app is running on. Results are
        passed to the callback, with the first argument of the callback reserved
        for any exceptions that occurred (node.js style).
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>doc</th>
            <td class="type">Object</td>
          </tr>
          <tr>
            <th>callback</th>
            <td class="type">Function</td>
          </tr>
        </tbody>
      </table>

      <h4 id="db_getView">
        db.getView(view, q, callback)
      </h4>
      <p>
        Fetches a view from the database the app is running on. Results are
        passed to the callback, with the first argument of the callback reserved
        for any exceptions that occurred (node.js style).
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>view</th>
            <td class="type">String</td>
          </tr>
          <tr>
            <th>q</th>
            <td class="type">Object</td>
            <td class="description">(optional)</td>
          </tr>
          <tr>
            <th>callback</th>
            <td class="type">Function</td>
          </tr>
        </tbody>
      </table>

      <h4 id="db_all">
        db.all(q, callback)
      </h4>
      <p>
        Get all documents (including design docs).
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>q</th>
            <td class="type">Object</td>
            <td class="description">(optional)</td>
          </tr>
          <tr>
            <th>callback</th>
            <td class="type">Function</td>
          </tr>
        </tbody>
      </table>

      <h4 id="db_getRewrite">
        db.getRewrite(view, q, callback)
      </h4>
      <p>
        Fetches a rewrite from the database the app is running on. Results
        are passed to the callback, with the first argument of the callback
        reserved for any exceptions that occurred (node.js style).
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>path</th>
            <td class="type">String</td>
          </tr>
          <tr>
            <th>q</th>
            <td class="type">Object</td>
            <td class="description">(optional)</td>
          </tr>
          <tr>
            <th>callback</th>
            <td class="type">Function</td>
          </tr>
        </tbody>
      </table>

      <h4 id="db_getList">
        db.getList(list, view, q, callback)
      </h4>
      <p>
        Transforms and fetches a view through a list from the database the app
        is running on. Results are passed to the callback, with the first
        argument of the callback reserved for any exceptions that occurred (node.js style).
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>list</th>
            <td class="type">String</td>
          </tr>
          <tr>
            <th>view</th>
            <td class="type">String</td>
          </tr>
          <tr>
            <th>q</th>
            <td class="type">Object</td>
            <td class="description">(optional)</td>
          </tr>
          <tr>
            <th>callback</th>
            <td class="type">Function</td>
          </tr>
        </tbody>
      </table>

      <h4 id="db_getShow">
        db.getShow(show, docid, q, callback)
      </h4>
      <p>
        Transforms and fetches a document through a show from the database the app
        is running on. Results are passed to the callback, with the first
        argument of the callback reserved for any exceptions that occurred
        (node.js style).
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>show</th>
            <td class="type">String</td>
          </tr>
          <tr>
            <th>docid</th>
            <td class="type">String</td>
          </tr>
          <tr>
            <th>q</th>
            <td class="type">Object</td>
            <td class="description">(optional)</td>
          </tr>
          <tr>
            <th>callback</th>
            <td class="type">Function</td>
          </tr>
        </tbody>
      </table>

      <h4 id="db_stringifyQuery">
        db.stringifyQuery(query)
      </h4>
      <p>
        Properly encodes query parameters to CouchDB views etc. Handle complex
        keys and other non-string parameters by passing through JSON.stringify.
        Returns a shallow-copied clone of the original query after complex values
        have been stringified.
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>query</th>
            <td class="type">Object</td>
          </tr>
        </tbody>
      </table>

      <div class="returns"><strong>Returns:</strong> Object</div>

      <h4 id="db_newUUID">
        db.newUUID(cacheNum, callback)
      </h4>
      <p>
        Returns a new UUID generated by CouchDB. Its possible to cache
        multiple UUIDs for later use, to avoid making too many requests.
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>cacheNum</th>
            <td class="type">Number</td>
            <td class="description">(Optional) Default: 1</td>
          </tr>
          <tr>
            <th>callback</th>
            <td class="type">Function</td>
          </tr>
        </tbody>
      </table>

      <h3 id="fields">Fields</h3>
      <p>
        The building blocks of Types and Forms, Fields help to validate and authorize
        changes to docuemnt values.
      </p>

      <h4 id="fields_Field">
        forms.Field(options)
      </h4>
      <p>
        Field objects are used when constructing content types and forms.
      </p>
      <div class="constructor">Constructor</div>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>options</th>
            <td class="type">Object</td>
            <td class="description">see below for available properties</td>
          </tr>
        </tbody>
      </table>

      <h5>Options:</h5>
      <table class="options">
        <tbody>
          <tr>
            <th>omit_empty</th>
            <td class="type">Boolean</td>
            <td class="description">Whether to omit the field from a document when the field is empty</td>
          </tr>
          <tr>
            <th>permissions</th>
            <td class="type">Object</td>
            <td class="description">A permissions check function or an object containing separate functions to run on create, edit and update operations.</td>
          </tr>
          <tr>
            <th>validators</th>
            <td class="type">Array</td>
            <td class="description">An array of validation functions (default: [])</td>
          </tr>
          <tr>
            <th>required</th>
            <td class="type">Boolean</td>
            <td class="description">Whether the field is required (default: true)</td>
          </tr>
          <tr>
            <th>description</th>
            <td class="type">String</td>
            <td class="description">A longer description of the field, rendered by the standard form renderers</td>
          </tr>
          <tr>
            <th>hint</th>
            <td class="type">String</td>
            <td class="description">A hint for using the widget, rendered by the standard form renderers</td>
          </tr>
        </tbody>
      </table>
      <div class="returns"><strong>Returns:</strong> Field Object</div>

      <h4 id="fields_Field">
        Field.parse(raw)
      </h4>
      <p>
        Parses a raw value returning the correct JavaScript type for this field.
        This will usually be overridden by other field types.
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>raw</th>
          </tr>
        </tbody>
      </table>

      <h4 id="fields_Field_isEmpty">
        Field.isEmpty(value, raw)
      </h4>
      <p>
        Test values to see if field is considered empty.
      </p>
      <p>
        This function accepts the raw value even though by default it only
        checks the parsed value, so that other field types overridding this method
        have the raw data available.
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>value</th>
            <td class="description">The parsed value for the field</td>
          </tr>
          <tr>
            <th>raw</th>
            <td class="description">The raw value for the field</td>
          </tr>
        </tbody>
      </table>

      <div class="returns"><strong>Returns:</strong> Boolean</div>

      <h4 id="fields_Field_validate">
        Field.validate(doc, value, raw)
      </h4>
      <p>
        Run the field's validation functions against a value. Returns an
        array of validation errors, or an empty array if valid.
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>doc</th>
            <td class="type">Object</td>
          </tr>
          <tr>
            <th>value</th>
          </tr>
          <tr>
            <th>raw</th>
          </tr>
        </tbody>
      </table>

      <div class="returns"><strong>Returns:</strong> Array</div>

      <h4 id="fields_Field_authorize">
        Field.authorize(newDoc, oldDoc, newVal, oldVal, userCtx)
      </h4>
      <p>
        Check relevant field permissions to see if user is authorised to make
        changes. Returns an array of permissions errors, or an empty array if the
        changes are permissible.
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>newDoc</th>
            <td class="type">Object</td>
          </tr>
          <tr>
            <th>oldDoc</th>
            <td class="type">Object</td>
          </tr>
          <tr>
            <th>newVal</th>
          </tr>
          <tr>
            <th>oldVal</th>
          </tr>
          <tr>
            <th>userCtx</th>
            <td class="type">Object</td>
          </tr>
        </tbody>
      </table>

      <div class="returns"><strong>Returns:</strong> Array</div>

      <h4 id="fields_Embedded">
        fields.Embedded(options)
      </h4>
      <p>
        Embedded objects represent a Type embedded within another Type or set of
        Fields. Its not a true field, but like the Field constructor it acts as a
        marker when walking through the sub-objects that make up a schema.
      </p>
      <p>
        Exposes the same methods as Field objects.
      </p>

      <div class="constructor">Constructor</div>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>options</th>
            <td class="type">Object</td>
            <td class="description">See below for available properties</td>
          </tr>
        </tbody>
      </table>

      <h5>Options:</h5>
      <table class="options">
        <tbody>
          <tr>
            <th>type</th>
            <td class="type">Type Object</td>
            <td class="description"><strong>Required</strong>, the Type definition to embed</td>
          </tr>
          <tr>
            <th>omit_empty</th>
            <td class="type">Boolean</td>
            <td class="description">Whether to omit the field from a document when the field is empty</td>
          </tr>
          <tr>
            <th>permissions</th>
            <td class="type">Object</td>
            <td class="description">A permissions check function or an object containing separate functions to run on create, edit and update operations.</td>
          </tr>
          <tr>
            <th>validators</th>
            <td class="type">Array</td>
            <td class="description">An array of validation functions (default: [])</td>
          </tr>
          <tr>
            <th>required</th>
            <td class="type">Boolean</td>
            <td class="description">Whether the field is required (default: true)</td>
          </td>
        </tbody>
      </table>

      <div class="returns"><strong>Returns:</strong> Embedded Object</div>

      <h4 id="fields_EmbeddedList">
        fields.EmbeddedList(options)
      </h4>
      <p>
        EmbeddedList objects represent multiple instances of a Type embedded within
        another Type or set of Fields. Its not a true field, but like the Field
        constructor it acts as a marker when walking through the sub-objects that
        make up a schema.
      </p>
      <p>
        Exposes the same methods as Field objects.
      </p>

      <div class="constructor">Constructor</div>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>options</th>
            <td class="type">Object</td>
            <td class="description">See below for available properties</td>
          </tr>
        </tbody>
      </table>

      <h5>Options:</h5>
      <table class="options">
        <tbody>
          <tr>
            <th>type</th>
            <td class="type">Type Object</td>
            <td class="description"><strong>Required</strong>, the Type definition to embed</td>
          </tr>
          <tr>
            <th>omit_empty</th>
            <td class="type">Boolean</td>
            <td class="description">Whether to omit the field from a document when the field is empty</td>
          </tr>
          <tr>
            <th>permissions</th>
            <td class="type">Object</td>
            <td class="description">A permissions check function or an object containing separate functions to run on create, edit and update operations.</td>
          </tr>
          <tr>
            <th>validators</th>
            <td class="type">Array</td>
            <td class="description">An array of validation functions (default: [])</td>
          </tr>
          <tr>
            <th>required</th>
            <td class="type">Boolean</td>
            <td class="description">Whether the field is required (default: true)</td>
          </td>
        </tbody>
      </table>

      <div class="returns"><strong>Returns:</strong> EmbeddedList Object</div>

      <h4 id="fields_EmbeddedList_missingIDs">
        EmbeddedList.missingIDs(list)
      </h4>
      <p>
        Detects embedded documents with missing _id properties and returns an
        array of Error objects for each occurence. Returns an empty array if
        all documents have a populated _id property.
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>list</th>
            <td class="type">Array</td>
          </tr>
        </tbody>
      </table>

      <div class="returns"><strong>Returns:</strong> Array</div>

      <h4 id="fields_EmbeddedList_duplicateIDs">
        EmbeddedList.duplicateIDs(list)
      </h4>
      <p>
        Detects embedded documents with duplicate _id properties and returns an
        array of Error objects for each occurence. Returns an empty array if
        all documents have a unique _id property.
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>list</th>
            <td class="type">Array</td>
          </tr>
        </tbody>
      </table>

      <div class="returns"><strong>Returns:</strong> Array</div>

      <h4 id="fields_string">
        fields.string(options)
      </h4>
      <p>
        Creates a new string Field
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>options</th>
            <td class="type">Object</td>
            <td class="description">See the Field constructor for available options</td>
          </tr>
        </tbody>
      </table>

      <div class="returns"><strong>Returns:</strong> Field Object</div>

      <h4 id="fields_number">
        fields.number(options)
      </h4>
      <p>
        Creates a new number Field
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>options</th>
            <td class="type">Object</td>
            <td class="description">See the Field constructor for available options</td>
          </tr>
        </tbody>
      </table>

      <div class="returns"><strong>Returns:</strong> Field Object</div>

      <h4 id="fields_boolean">
        fields.boolean(options)
      </h4>
      <p>
        Creates a new boolean Field
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>options</th>
            <td class="type">Object</td>
            <td class="description">See the Field constructor for available options</td>
          </tr>
        </tbody>
      </table>

      <div class="returns"><strong>Returns:</strong> Field Object</div>

      <h4 id="fields_url">
        fields.url(options)
      </h4>
      <p>
        Creates a new URL Field
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>options</th>
            <td class="type">Object</td>
            <td class="description">See the Field constructor for available options</td>
          </tr>
        </tbody>
      </table>

      <div class="returns"><strong>Returns:</strong> Field Object</div>

      <h4 id="fields_email">
        fields.email(options)
      </h4>
      <p>
        Creates a new email Field
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>options</th>
            <td class="type">Object</td>
            <td class="description">See the Field constructor for available options</td>
          </tr>
        </tbody>
      </table>

      <div class="returns"><strong>Returns:</strong> Field Object</div>

      <h4 id="fields_creator">
        fields.creator(options)
      </h4>
      <p>
        Creates a new creator Field
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>options</th>
            <td class="type">Object</td>
            <td class="description">See the Field constructor for available options</td>
          </tr>
        </tbody>
      </table>

      <div class="returns"><strong>Returns:</strong> Field Object</div>

      <h4 id="fields_timestamp">
        fields.timestamp(options)
      </h4>
      <p>
        Creates a new timestamp Field
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>options</th>
            <td class="type">Object</td>
            <td class="description">See the Field constructor for available options</td>
          </tr>
        </tbody>
      </table>

      <div class="returns"><strong>Returns:</strong> Field Object</div>

      <h4 id="fields_choice">
        fields.choice(options)
      </h4>
      <p>
        Creates a new choice Field
      </p>
      <p>
        <strong>Required option:</strong> values - an array of possible choices, each an array
        with the first item as the value and the second as its label.
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>options</th>
            <td class="type">Object</td>
            <td class="description">See the Field constructor for available options</td>
          </tr>
        </tbody>
      </table>

      <div class="returns"><strong>Returns:</strong> Field Object</div>

      <h4 id="fields_numberChoice">
        fields.numberChoice(options)
      </h4>
      <p>
        Creates a new numberChoice Field
      </p>
      <p>
        <strong>Required option:</strong> values - an array of possible choices, each an array
        with the first item as the value and the second as its label.
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>options</th>
            <td class="type">Object</td>
            <td class="description">See the Field constructor for available options</td>
          </tr>
        </tbody>
      </table>

      <div class="returns"><strong>Returns:</strong> Field Object</div>


      <h4 id="fields_array">
        fields.array(options)
      </h4>
      <p>
        Creates a array Field. The default parse function expects a single row of
        comma separated values.
      </p>
      <p>
        To accept an array of values other than strings, add a function to options
        called parseEach which accepts the string value for each item and performs
        the transformation.
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>options</th>
            <td class="type">Object</td>
            <td class="description">See the Field constructor for available options</td>
          </tr>
        </tbody>
      </table>

      <div class="returns"><strong>Returns:</strong> Field Object</div>

      <h4 id="fields_numberArray">
        fields.numberArray(options)
      </h4>
      <p>
        Creates a number array Field, same as the array field only each value is
        parsed as a number instead of a string.
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>options</th>
            <td class="type">Object</td>
            <td class="description">See the Field constructor for available options</td>
          </tr>
        </tbody>
      </table>

      <div class="returns"><strong>Returns:</strong> Field Object</div>


      <h4 id="fields_embed">
        fields.embed(options)
      </h4>
      <p>
        Creates a new Embedded Field
      </p>
      <p>
        <strong>Required option:</strong> type - the Type definition to embed
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>options</th>
            <td class="type">Object</td>
            <td class="description">See the Field constructor for available options</td>
          </tr>
        </tbody>
      </table>

      <div class="returns"><strong>Returns:</strong> Embedded Object</div>

      <h4 id="fields_embedList">
        fields.embedList(options)
      </h4>
      <p>
        Creates a new EmbeddedList Field
      </p>
      <p>
        <strong>Required option:</strong> type - the Type definition to embed
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>options</th>
            <td class="type">Object</td>
            <td class="description">See the Field constructor for available options</td>
          </tr>
        </tbody>
      </table>

      <div class="returns"><strong>Returns:</strong> EmbeddedList Object</div>


      <h3 id="flashmessages">Flashmessages</h3>
      <p>
        Flash messages help you store state between requests, such as reporting a
        successful or failed operation after a redirect.
      </p>
      <p>
        The flash message implementation in this module handles both fallback couchdb
        mode, using cookies to persist state between requests, as well as supporting
        client-side operation, correctly handling new messages even inside the
        callbacks of async functions.
      </p>
      <p>
        Flash messages only persist for the next request or the next template render!
        That means 2 redirects without explicitly currying the flash messages will
        cause the messages to be lost.
      </p>

      <h4 id="flashmessages_readRequestCookie">
        flashmessages.readRequestCookie(req)
      </h4>
      <p>
        Reads the flash messages cookie from a request object, returning an
        array of incoming messages.
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>req</th>
            <td class="type">Object</td>
          </tr>
        </tbody>
      </table>

      <div class="returns"><strong>Returns:</strong> Array</div>

      <h4 id="flashmessages_readBrowserCookie">
        flashmessages.readBrowserCookie()
      </h4>
      <p>
        Reads the flash messages cookie from the browser, returning an
        array of incoming messages.
      </p>

      <div class="returns"><strong>Returns:</strong> Array</div>

      <h4 id="flashmessages_updateRequest">
        flashmessages.updateRequest(req)
      </h4>
      <p>
        Adds a flash_messages property to a request containing all incoming
        messages.
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>req</th>
            <td class="type">Object</td>
          </tr>
        </tbody>
      </table>

      <div class="returns"><strong>Returns:</strong> Request Object</div>

      <h4 id="flashmessages_getMessages">
        flashmessages.getMessages(req)
      </h4>
      <p>
        Get's all current flash messages, stopping them from being outgoing on the
        next request so they're not repeated.
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>req</th>
            <td class="type">Object</td>
          </tr>
        </tbody>
      </table>

      <div class="returns"><strong>Returns:</strong> Array</div>

      <h4 id="flashmessages_getOutgoingMessages">
        flashmessage.getOutgoingMessages(req)
      </h4>
      <p>
        Filters all available messages on a request object, returning only those
        flagged as outgoing (sending in the response to be made available to the next
        request).
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>req</th>
            <td class="type">Object</td>
          </tr>
        </tbody>
      </table>

      <div class="returns"><strong>Returns:</strong> Array</div>

      <h4 id="flashmessages_updateResponse">
        flashmessage.updateResponse(req, res)
      </h4>
      <p>
        Updates a response object after a list, show or update function has returned,
        setting the flash messages cookie to include the outgoing messages.
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>req</th>
            <td class="type">Object</td>
          </tr>
          <tr>
            <th>res</th>
            <td class="type">Object</td>
          </tr>
        </tbody>
      </table>

      <div class="returns"><strong>Returns:</strong> Response Object</div>

      <h4 id="flashmessages_createMessage">
        flashmessages.createMessage(req, msg)
      </h4>
      <p>
        Creates a new flash message object, associating it with the given request.
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>req</th>
            <td class="type">Object</td>
          </tr>
          <tr>
            <th>msg</th>
            <td class="type">String</td>
          </tr>
        </tbody>
      </table>

      <div class="returns"><strong>Returns:</strong> Object</div>

      <h4 id="flashmessages_setBrowserCookie">
        flashmessages.setBrowserCookie(req, messages)
      </h4>
      <p>
        Stores a list of messages in the flash messages cookie. This function is for
        client-side use.
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>req</th>
            <td class="type">Object</td>
          </tr>
          <tr>
            <th>messages</th>
            <td class="type">Array</td>
          </tr>
        </tbody>
      </table>

      <h4 id="flashmessages_addMessage">
        flashmessages.addMessage(req, msg)
      </h4>
      <p>
        Adds a new flash message for the current request. If the list, show or update
        function has not returned, it's added to the response Set-Cookie header,
        otherwise (if its the result of a client-side async operation) it's added
        directly to the browsers cookies.
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>req</th>
            <td class="type">Object</td>
          </tr>
          <tr>
            <th>msg</th>
            <td class="type">String</td>
          </tr>
        </tbody>
      </table>


      <h3 id="permissions">Permissions</h3>
      <p>
        Used on both Fields and Types to check a given user is authorized to make
        a change to a document.
      </p>

      <h4 id="permissions_matchUsername">
        permissions.matchUsername()
      </h4>
      <p>
        Field's new value should match current user's name
      </p>

      <div class="returns"><strong>Returns:</strong> Function</div>

      <h4 id="permissions_hasRole">
        permissions.hasRole(role)
      </h4>
      <p>
        Checks if the user has a specific role
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>role</th>
            <td class="type">String</td>
          </tr>
        </tbody>
      </table>

      <div class="returns"><strong>Returns:</strong> Function</div>

      <h4 id="permissions_fieldUneditable">
        permissions.fieldUneditable()
      </h4>
      <p>
        The value of this field should never change after the document has been
        created.
      </p>

      <div class="returns"><strong>Returns:</strong> Function</div>

      <h4 id="permissions_usernameMatchesField">
        permissions.usernameMatchesField(path)
      </h4>
      <p>
        User's name should match the *old* value of the given field. A field can be
        specified using a string or an array of strings (like a path), eg:
      </p>
      <pre>usernameMatchesField('creator')
usernameMatchesField(['meta','creator'])
 
{
    creator: 'name',
    meta: {creator: 'name2'}
}</pre>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>path</th>
          </tr>
        </tbody>
      </table>

      <div class="returns"><strong>Returns:</strong> Function</div>

      <h4 id="permissions_loggedIn">
        permissions.loggedIn()
      </h4>
      <p>
        Checks that user's context has a username
      </p>

      <div class="returns"><strong>Returns:</strong> Function</div>

      <h4 id="permissions_all">
        permissions.all(perms)
      </h4>
      <p>
        Runs an array of permissions functions and checks that all of them pass,
        returning all failures.
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>perms</th>
            <td class="type">Array</td>
          </tr>
        </tbody>
      </table>

      <div class="returns"><strong>Returns:</strong> Function</div>

      <h4 id="permissions_any">
        permissions.any(perms)
      </h4>
      <p>
        Tests to see if any one permission function passes, returning on the
        first success. If all permissions fail, then all errors are returned.
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>perms</th>
            <td class="type">Array</td>
          </tr>
        </tbody>
      </table>

      <div class="returns"><strong>Returns:</strong> Function</div>

      <h4 id="permissions_inherit">
        permissions.inherit(type)
      </h4>
      <p>
        Treat new and old values like new documents of a given type, and attempt to
        authorize the value against the type's permissions. Useful when handling 
        permissions for an embedded type.
      </p>
      <p>
        Can be combined with permissions.any or permissions.all to extend the
        permissions for an embedded type field. For example, the following might
        allow both the owner of the parent document and the owner of the comment
        itself to remove it.
      </p>
      <pre><code class="javascript">comment: fields.embed({
    type: types.comment,
    permissions: {
        remove: permissions.any([
            permissions.usernameMatchesField('creator'),
            permissions.inherit(types.comment)
        ])
    }
});</code></pre>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>type</th>
            <td class="type">Type Object</td>
          </tr>
        </tbody>
      </table>

      <div class="returns"><strong>Returns:</strong> Function</div>


      <h3 id="session">Session</h3>
      <p>
        Functions related to the management of user sessions and account information.
      </p>

      <h4 id="session_fakeRequest">
        session.fakeRequest(userCtx, callback)
      </h4>
      <p>
        Creates a fake request to /_session to pass to sessionChange, useful
        when using functions such as templates.render
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>userCtx</th>
            <td class="type">Object</td>
          </tr>
          <tr>
            <th>callback</th>
            <td class="type">Function</td>
          </tr>
        </tbody>
      </table>

      <h4 id="session_sessionChange">
        session.sessionChange(userCtx, callback)
      </h4>
      <p>
        Calls sessionChange if exported from the currently loaded app.
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>userCtx</th>
            <td class="type">Object</td>
          </tr>
          <tr>
            <th>callback</th>
            <td class="type">Function</td>
          </tr>
        </tbody>
      </table>

      <h4 id="session_logout">
        session.logout(callback)
      </h4>
      <p>
        Logs out the current user.
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>callback</th>
            <td class="type">Function</td>
          </tr>
        </tbody>
      </table>

      <h4 id="session_login">
        session.login(username, password, callback)
      </h4>
      <p>
        Attempt to login using the username and password provided.
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>username</th>
            <td class="type">String</td>
          </tr>
          <tr>
            <th>password</th>
            <td class="type">String</td>
          </tr>
          <tr>
            <th>callback</th>
            <td class="type">Function</td>
          </tr>
        </tbody>
      </table>

      <h4 id="session_info">
        session.info(callback)
      </h4>
      <p>
        Returns the current user's session information.
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>callback</th>
            <td class="type">Function</td>
          </tr>
        </tbody>
      </table>

      <h4 id="session_userDb">
        session.userDb(callback)
      </h4>
      <p>
        Returns the authentication database for the current user's session.
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>callback</th>
            <td class="type">Function</td>
          </tr>
        </tbody>
      </table>

      <h4 id="session_signup">
        session.signup(username, password, callback)
      </h4>
      <p>
        Creates a new user document with given username and password.
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>username</th>
            <td class="type">String</td>
          </tr>
          <tr>
            <th>password</th>
            <td class="type">String</td>
          </tr>
          <tr>
            <th>callback</th>
            <td class="type">Function</td>
          </tr>
        </tbody>
      </table>

      <h3 id="templates">Templates</h3>
      <p>
        Kanso uses Dust templates for rendering pages.
        To learn more about the syntax, see the
        <a href="http://akdubya.github.com/dustjs/">Dust site</a>.
      </p>
      <p>
        Since Dust stores compiled templates on the module itself, the
        templates module does some interesting things to work around the lack
        of a module cache in CouchDB. Because of this, compiled templates are
        automatically added to this module from your templates folder each time
        your app is pushed to CouchDB. You can see a list of the loaded template
        names on the 'loaded' property of this module.
      </p>

      <h4 id="templates_render">
        templates.render(name, req, context)
      </h4>
      <p>
        Synchronously render dust template and return the result.
        The request object is required so we can determine the value of baseURL.
      </p>

      <h5>Context Variables</h5>
      <p class="small">
        The following context variables are automatically made available to
        templates:
      </p>
      <table class="params">
        <tbody>
          <tr>
            <th>baseURL</th>
            <td class="type">String</td>
            <td class="description">Base URL for the site, all app URLs should start with this</td>
          </tr>
          <tr>
            <th>userCtx</th>
            <td class="type">Object</td>
            <td class="description">The request's user context (username, roles, etc)</td>
          </tr>
          <tr>
            <th>isBrowser</th>
            <td class="type">Boolean</td>
            <td class="description">Whether this template is being rendered by the browser or CouchDB</td>
          </tr>
          <tr>
            <th>flashMessages</th>
            <td class="type">Array</td>
            <td class="description">Messages added using the flashmessages module</td>
          </tr>
        </tbody>
      </table>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>name</th>
            <td class="type">String</td>
          </tr>
          <tr>
            <th>req</th>
            <td class="type">Request Object</td>
          </tr>
          <tr>
            <th>context</th>
            <td class="type">Object</td>
          </tr>
        </tbody>
      </table>

      <div class="returns"><strong>Returns:</strong> String</div>

      <h3 id="types">Types</h3>
      <p>
        Document types can be used to ease the validation of updates and check
        permissions when creating, editing or deleting documents.
      </p>

      <h4 id="types_Type">
        types.Type(name, options)
      </h4>
      <p>
        Creates a new Type object
      </p>

      <div class="constructor">constructor</div>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>options</th>
            <td class="type">Object</td>
            <td class="description">see below for available properties</td>
          </tr>
        </tbody>
      </table>

      <h5>Options:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>fields</th>
            <td class="type">Object</td>
            <td class="description">Field objects to use as the Type's schema</td>
          </tr>
          <tr>
            <th>permissions</th>
            <td class="type">Object</td>
            <td class="description">
              a permissions check function or an object
              containing separate functions to run on add, remove and update
              operations
            </td>
          </tr>
        </tbody>
      </table>

      <div class="returns"><strong>Returns:</strong> Type Object</div>

      <h4 id="types_Type_validate">
        Type.validate(doc, rawDoc)
      </h4>
      <p>
        Run field validators against document and check for missing required
        fields or extra fields when the Types's allow_extra_fields property is
        set to false.
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>doc</th>
            <td class="type">Object</td>
          </tr>
          <tr>
            <th>rawDoc</th>
            <td class="type">Object</td>
          </tr>
        </tbody>
      </table>

      <div class="returns"><strong>Returns:</strong> Array</div>

      <h4 id="types_Type_authorize">
        Type.authorize(nDoc, oDoc, user)
      </h4>
      <p>
        Run field permissions checks against userCtx and document.
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>nDoc</th>
            <td class="type">Object</td>
            <td class="description">new document</td>
          </tr>
          <tr>
            <th>oDoc</th>
            <td class="type">Object</td>
            <td class="description">old document</td>
          </tr>
          <tr>
            <th>userCtx</th>
            <td class="type">Object</td>
            <td class="description">user context object</td>
          </tr>
        </tbody>
      </table>

      <div class="returns"><strong>Returns:</strong> Array</div>

      <h4 id="types_Type_authField">
        Type.authField(f, nDoc, oDoc, nVal, oVal, user, path)
      </h4>
      <p>
        Authorize a specific field, returning all permissions errors as an array with
        each error's field property prefixed by the current path.
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>f</th>
            <td class="type">Field</td>
            <td class="description">field object</td>
          </tr>
          <tr>
            <th>nDoc</th>
            <td class="type">Object</td>
            <td class="description">new document</td>
          </tr>
          <tr>
            <th>oDoc</th>
            <td class="type">Object</td>
            <td class="description">old document</td>
          </tr>
          <tr>
            <th>nVal</th>
            <td class="type"></td>
            <td class="description">new field value</td>
          </tr>
          <tr>
            <th>oVal</th>
            <td class="type"></td>
            <td class="description">old field value</td>
          </tr>
          <tr>
            <th>user</th>
            <td class="type">Object</td>
            <td class="description">user context object</td>
          </tr>
          <tr>
            <th>path</th>
            <td class="type">Array</td>
            <td class="description">current path</td>
          </tr>
        </tbody>
      </table>

      <div class="returns"><strong>Returns:</strong> Array</div>

      <h4 id="types_Type_authFieldSet">
        Type.authFieldSet(f, nDoc, oDoc, nVal, oVal, user, path)
      </h4>
      <p>
        Authorizes an object containing fields or other sub-objects, iterating over
        each property and recursing through sub-objects to find all Fields.
      </p>
      <p>
        Returns an array of permissions errors, each with a field property set to the
        path of the field which caused the error.
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>f</th>
            <td class="type">Field</td>
            <td class="description">field object</td>
          </tr>
          <tr>
            <th>nDoc</th>
            <td class="type">Object</td>
            <td class="description">new document</td>
          </tr>
          <tr>
            <th>oDoc</th>
            <td class="type">Object</td>
            <td class="description">old document</td>
          </tr>
          <tr>
            <th>nVal</th>
            <td class="type"></td>
            <td class="description">new field value</td>
          </tr>
          <tr>
            <th>oVal</th>
            <td class="type"></td>
            <td class="description">old field value</td>
          </tr>
          <tr>
            <th>user</th>
            <td class="type">Object</td>
            <td class="description">user context object</td>
          </tr>
          <tr>
            <th>path</th>
            <td class="type">Array</td>
            <td class="description">current path</td>
          </tr>
        </tbody>
      </table>

      <div class="returns"><strong>Returns:</strong> Array</div>

      <h4 id="types_Type_create">
        Type.create(userCtx, callback)
      </h4>
      <p>
        Create's a new object for this Type. Pre-filling any default values and
        providing a new _id value. This is a convenient funciton to use when creating
        a type to embed within another.
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>userCtx</th>
            <td class="type">Object</td>
          </tr>
          <tr>
            <th>callback</th>
            <td class="type">Function</td>
          </tr>
        </tbody>
      </table>

      <h4 id="types_validate_doc_update ">
        types.validate_doc_update(types, newDoc, oldDoc, userCtx)
      </h4>
      <p>
        Calls validation and permissions functions relevant to a document update.
        This should be called from your app's exported validate_doc_update function
        if you wish to use kanso Types in you project.
      </p>
      <p>
        Throws on error.
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>types</th>
            <td class="type">Object</td>
          </tr>
          <tr>
            <th>newDoc</th>
            <td class="type">Object</td>
          </tr>
          <tr>
            <th>oldDoc</th>
            <td class="type">Object</td>
          </tr>
          <tr>
            <th>userCtx</th>
            <td class="type">Object</td>
          </tr>
        </tbody>
      </table>

      <h3 id="utils">Utils</h3>
      <p>
        General utility functions used by Kanso. Some functions were moved here from
        other modules (such as core), to avoid a circular dependency bug in CouchDB.
      </p>

      <h4 id="utils_properties">Utils properties</h4>
      <p>
        The utils module exports some useful properties you may want to use inside
        your own functions:
      </p>

      <table class="params">
        <tbody>
          <tr>
            <th>isBrowser</th>
            <td class="type">Boolean</td>
            <td class="description">whether or not the current code is running in the browser (not in CouchDB)</td>
          </tr>
          <tr>
            <th>initial_hit</th>
            <td class="type">Boolean</td>
            <td class="description">set to true when the page is first loaded from CouchDB</td>
          </tr>
          <tr>
            <th>userCtx</th>
            <td class="type">Object</td>
            <td class="description">stores cached user context information (username etc)</td>
          </tr>
          <tr>
            <th>session</th>
            <td class="type">Object</td>
            <td class="description">stores cached extended user session info</td>
          </tr>
        </tbody>
      </table>


      <h4 id="utils_getBaseURL">
        utils.getBaseURL(req)
      </h4>
      <p>
        Returns the path to prefix to any URLs. When running behind a
        virtual host, there is nothing to prefix URLs with. When accessing the
        app directly, URLs need to be prefixed with /db/_design/appname/_rewrite.
      </p>
      <p>
        The request object argument is only required when run server-side.
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>req</th>
            <td class="type">Object</td>
          </tr>
        </tbody>
      </table>

      <div class="returns"><strong>Returns:</strong> String</div>

      <h4 id="utils_getPropertyPath">
        utils.getPropertyPath(obj, path)
      </h4>
      <p>
        Traverses an object and its sub-objects using an array of property names.
        Returns the value of the matched path, or undefined if the property does not
        exist.
      </p>
      <pre>getPropertyPath({a: {b: 'foo'}}, ['a','b']) -&gt; 'foo'</pre>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>obj</th>
            <td class="type">Object</td>
          </tr>
          <tr>
            <th>path</th>
            <td class="type">Array</td>
          </tr>
        </tbody>
      </table>

      <h4 id="utils_setPropertyPath">
        utils.setPropertyPath(obj, path, val)
      </h4>
      <p>
        Traverses an object and its sub-objects using an array of property names.
        Sets the value of the matched property.
      </p>
      <pre>setPropertyPath({}, ['a','b'], 'foo') -&gt; {a: {b: 'foo'}}</pre>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>obj</th>
            <td class="type">Object</td>
          </tr>
          <tr>
            <th>path</th>
            <td class="type">Array</td>
          </tr>
          <tr>
            <th>val</th>
          </tr>
        </tbody>
      </table>

      <h4 id="utils_constructorName">
        utils.constructorName(obj)
      </h4>
      <p>
        Returns the name of the constructor function for an object. This is used
        as a workaround for CouchDB's lack of a module cache, where instanceof checks
        can break if a module is re-eval'd.
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>obj</th>
            <td class="type">Object</td>
          </tr>
        </tbody>
      </table>

      <div class="returns"><strong>Returns:</strong> String</div>

      <h4 id="utils_getErrors">
        utils.getErrors(fn, args)
      </h4>
      <p>
        Call function with arguments, catch any errors and add to an array,
        returning the modified array.
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>arr</th>
            <td class="type">Array</td>
          </tr>
          <tr>
            <th>fn</th>
            <td class="type">Function</td>
          </tr>
          <tr>
            <th>args</th>
            <td class="type">Array</td>
          </tr>
        </tbody>
      </table>

      <div class="returns"><strong>Returns:</strong> Array</div>


      <h3 id="validators">Validators</h3>
      <p>
        Validation functions used to validate Field contents.
      </p>
      
      <h4 id="validators_min">
        validators.min(min)
      </h4>
      <p>
        Tests that the field's value is greater than 'min'.
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>min</th>
            <td class="type">Number</td>
          </tr>
        </tbody>
      </table>

      <div class="returns"><strong>Returns:</strong> Function</div>

      <h4 id="validators_max">
        validators.max(max)
      </h4>
      <p>
        Tests that the field's value is less than 'max'
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>max</th>
            <td class="type">Number</td>
          </tr>
        </tbody>
      </table>

      <div class="returns"><strong>Returns:</strong> Function</div>

      <h4 id="validators_range">
        validators.range(min, max)
      </h4>
      <p>
        Tests that the field's value is greater than 'min' AND less than 'max'
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>min</th>
            <td class="type">Number</td>
          </tr>
          <tr>
            <th>max</th>
            <td class="type">Number</td>
          </tr>
        </tbody>
      </table>

      <div class="returns"><strong>Returns:</strong> Function</div>

      <h4 id="validators_minlength">
        validators.minlength(val)
      </h4>
      <p>
        Tests that the field's value length is greater than 'val'
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>val</th>
            <td class="type">Number</td>
          </tr>
        </tbody>
      </table>

      <div class="returns"><strong>Returns:</strong> Function</div>

      <h4 id="validators_maxlength">
        validators.maxlength(val)
      </h4>
      <p>
        Tests that the field's value length is less than 'val'
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>val</th>
            <td class="type">Number</td>
          </tr>
        </tbody>
      </table>

      <div class="returns"><strong>Returns:</strong> Function</div>

      <h4 id="validators_rangelength">
        validators.rangelength(min, max)
      </h4>
      <p>
        Tests that the field's value length is greater than 'min' AND less than 'max'
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>min</th>
            <td class="type">Number</td>
          </tr>
          <tr>
            <th>max</th>
            <td class="type">Number</td>
          </tr>
        </tbody>
      </table>

      <div class="returns"><strong>Returns:</strong> Function</div>

      <h4 id="validators_regexp">
        validators.regexp(re, message)
      </h4>
      <p>
        Tests field's value against a regular expression
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>re</th>
            <td class="type">RegExp</td>
            <td class="description">can be a string or a RegExp object</td>
          </tr>
          <tr>
            <th>message</th>
            <td class="type">String</td>
            <td class="description">(Optional) a custom error message to throw</td>
          </tr>
        </tbody>
      </table>

      <div class="returns"><strong>Returns:</strong> Function</div>

      <h4 id="validators_email">
        validators.email()
      </h4>
      <p>
        Tests that field's value is a valid email address using a regular expression.
      </p>

      <div class="returns"><strong>Returns:</strong> Function</div>

      <h4 id="validators_url">
        validators.url()
      </h4>
      <p>
        Tests that field's value is a valid URL using a regular expression.
      </p>

      <div class="returns"><strong>Returns:</strong> Function</div>

      <h4 id="validators_missingIDs">
        validators.missingIDs()
      </h4>
      <p>
        Detects embedded documents with missing _id properties and returns an
        array of Error objects for each occurence. Returns an empty array if
        all documents have a populated _id property.
      </p>
      <p>
        Used by the EmbeddedList field type.
      </p>

      <div class="returns"><strong>Returns:</strong> Function</div>


      <h3 id="widgets">Widgets</h3>
      <p>
        Widgets define the way a Field object is displayed when rendered as part of a
        Form. Changing a Field's widget will be reflected in the admin app.
      </p>

      <h4 id="widgets_Widget">
        widgets.Widget(type, options)
      </h4>
      <p>
        Widget constructor, creates a new Widget object.
      </p>

      <div class="constructor">constructor</div>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>type</th>
            <td class="type">String</td>
          </tr>
          <tr>
            <th>options</th>
            <td class="type">Object</td>
          </tr>
        </tbody>
      </table>

      <h5>Options:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>classes</th>
            <td class="type">Array</td>
            <td class="description">classes to add to the HTML element</td>
          </tr>
          <tr>
            <th>id</th>
            <td class="type">String</td>
            <td class="description">id to use for the HTML element</td>
          </tr>
        </tbody>
      </table>

      <div class="returns"><strong>Returns:</strong> Widget Object</div>

      <h4 id="widgets_Widget_toHTML">
        Widget.toHTML(name, value, raw)
      </h4>
      <p>
        Converts a widget to HTML using the provided name and parsed and raw values
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>name</th>
            <td class="type">String</td>
          </tr>
          <tr>
            <th>value</th>
          </tr>
          <tr>
            <th>raw</th>
          </tr>
        </tbody>
      </table>

      <div class="returns"><strong>Returns:</strong> String</div>

      <h4 id="widgets_text">
        widgets.text(options)
      </h4>
      <p>
        Creates a new text input widget.
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>options</th>
            <td class="type">Object</td>
          </tr>
        </tbody>
      </table>

      <div class="returns"><strong>Returns:</strong> Widget Object</div>

      <h4 id="widgets_password">
        widgets.password(options)
      </h4>
      <p>
        Creates a new password input widget.
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>options</th>
            <td class="type">Object</td>
          </tr>
        </tbody>
      </table>

      <div class="returns"><strong>Returns:</strong> Widget Object</div>

      <h4 id="widgets_hidden">
        widgets.hidden(options)
      </h4>
      <p>
        Creates a new hidden input widget.
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>options</th>
            <td class="type">Object</td>
          </tr>
        </tbody>
      </table>

      <div class="returns"><strong>Returns:</strong> Widget Object</div>

      <h4 id="widgets_textarea">
        widgets.textarea(options)
      </h4>
      <p>
        Creates a new textarea input widget.
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>options</th>
            <td class="type">Object</td>
          </tr>
        </tbody>
      </table>

      <div class="returns"><strong>Returns:</strong> Widget Object</div>

      <h4 id="widgets_checkbox">
        widgets.checkbox(options)
      </h4>
      <p>
        Creates a new checkboxinput widget.
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>options</th>
            <td class="type">Object</td>
          </tr>
        </tbody>
      </table>

      <div class="returns"><strong>Returns:</strong> Widget Object</div>

      <h4 id="widgets_select">
        widgets.select(options)
      </h4>
      <p>
        Creates a new select input widget.
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>options</th>
            <td class="type">Object</td>
          </tr>
        </tbody>
      </table>

      <div class="returns"><strong>Returns:</strong> Widget Object</div>

      <h4 id="widgets_computed">
        widgets.computed(options)
      </h4>
      <p>
        Creates a new computed widget. Computed widgets display a string, but are
        uneditable, working as a hidden field behind the scenes.
      </p>

      <h5>Parameters:</h5>
      <table class="params">
        <tbody>
          <tr>
            <th>options</th>
            <td class="type">Object</td>
          </tr>
        </tbody>
      </table>

      <div class="returns"><strong>Returns:</strong> Widget Object</div>


      <h2 id="commands">Commands</h2>
      <p>
        Typing 'kanso' with no arguments will present you with a list of available
        commands. More information can be found by typing 'kanso help' optionally
        followed by the name of the command you need help with.
      </p>

      <h3 id="push">Push</h3>
      <p>Upload a project to a CouchDB instance.</p>
      <pre>kanso push [OPTIONS] DB [PATH]

  Parameters:
    DB     The CouchDB instance to upload the app to
    PATH   The project path to load the app from

  Options:
    --minify               Compress CommonJS modules using UglifyJS
    --minify-attachments   Compress .js attachments
    --baseURL PATH         Force the baseURL to a specific value.
                           (allows vhosts on CouchDB &lt; v1.1.x)
  </pre>

      <h3 id="autopush">Autopush</h3>
      <p>Upload a project, then watch files for changes.</p>
      <pre>kanso autopush [OPTIONS] DB [PATH]

  Parameters:
    DB     The CouchDB instance to upload the app to
    PATH   The project path to load the app from

  Options:
    --minify               Compress CommonJS modules using UglifyJS
    --minify-attachments   Compress .js attachments
    --baseURL PATH         Force the baseURL to a specific value.
                           (allows vhosts on CouchDB &lt; v1.1.x)
  </pre>

      <h3 id="pushdata">Pushdata</h3>
      <p>Push a file or directory of JSON files to DB.</p>
      <pre>kanso pushdata [OPTIONS] DB PATH

  Parameters:
    DB     The CouchDB instance to upload the documents to
    PATH   A file or directory containing JSON documents to upload

  Options:
    -f, --force      Ignore document conflict errors and upload anyway
  </pre>

      <h3 id="pushadmin">Pushadmin</h3>
      <p>Upload the kanso admin app to a CouchDB instance.</p>
      <pre>kanso pushadmin [OPTIONS] DB

Parameters:
  DB     The CouchDB instance to upload the app to

Options:
  --minify               Compress CommonJS modules using UglifyJS
  --minify-attachments   Compress .js attachments
  --baseURL PATH         Force the baseURL to a specific value.
                         (allows vhosts on CouchDB < v1.1.x)
</pre>

      <h3 id="create">Create</h3>
      <p>Create a new project skeleton.</p>
      <pre>kanso create PATH

  Parameters:
    PATH     Path to create a new project skeleton at, project name
             defaults to last directory in this path
  </pre>

      <h3 id="help">Help</h3>
      <p>Show help specific to a command.</p>
      <pre>kanso help [COMMAND]

  Parameters:
    COMMAND      The kanso command to show help on
  </pre>

      <h3 id="show">Show</h3>
      <p>Load a project and output resulting JSON</p>
      <pre>kanso show [PATH]

  Parameters:
    PATH     Path to project directory to show (defaults to ".")
  </pre>

      <h3 id="uuids">UUIDs</h3>
      <p>Returns UUIDs generated by a CouchDB instance.<p>
      <pre>kanso uuids [OPTIONS] [URL]

  Parameters:
    URL         The CouchDB instance to generate UUIDs from
                (defaults to http://localhost:5984)

  Options:
    -n [NUM], --number [NUM]    The number of UUIDs to generate (default: 1)
  </pre>

    </div>
  </div>

  <script src="http://yandex.st/highlightjs/5.16/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.5.1/jquery.min.js"></script>
  <script src="javascript/docs.js"></script>
  <script type="text/javascript">

    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-20477836-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();

  </script>
</body>
</html>
